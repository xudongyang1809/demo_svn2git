<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><!--     @desc “此代码是自动生成，请继续优化注释”	 @author 毛敏 022325	 @version 1.0.0	 @date 2019-05-09 08:55:41	 @Copyright: 江苏金恒信息科技股份有限公司 --><mapper namespace="MdDemandMDao">	<!-- 查询所有记录 过滤公司别 -->	<select id="findAll" parameterType="map" resultType="map">		select		*,case strStus when 'N' then '新增' when 'S' then '生效' else '' end as strStatuZH,		case strTypeId when '1' then '生产型原料' when '2' then '贸易型商品' when '3' then '维护型备件' else '' end as strTypeId1,		(SELECT u.strName from du_user u WHERE u.id = m.strRecipientId) AS strRecipientIdZH,		(SELECT u.strName from du_user u WHERE u.id = m.strDemandUserId) AS strDemandUserIdZH		from md_demand_m m		<where>			<if test="currentCompany != null and currentCompany != ''">				and companyId = #{currentCompany}			</if>			<if test="strApplyNo != null and strApplyNo != ''">				and strApplyNo like '%${strApplyNo}%'			</if>			<if test="strOrderNo != null and strOrderNo != ''">				and strOrderNo like '%${strOrderNo}%'			</if>			<if test="strTypeId != null and strTypeId != ''">				and strTypeId like '%${strTypeId}%'			</if>			<if test="strVendorNo != null and strVendorNo != ''">				and strVendorNo like '%${strVendorNo}%'			</if>			<if test="strApplyName != null and strApplyName != ''">				and strApplyName like '%${strApplyName}%'			</if>			<if test="strStus != null and strStus != ''">				and strStus like '%${strStus}%'			</if>		</where>   		order by createDateTime desc	</select>	<!-- 平衡分配： 查询所有记录 过滤公司别 -->	<select id="findBalanceAll01" parameterType="map" resultType="map">/*Y：需采购；N：无需采购；R：退回*/       /* select        a.strApplyNo,a.strApplyName,a.strOrderNo,a.strVendorNo,a.strDept,a.strDemandUserId,a.strPlanYearMo,a.strRecipientId,a.strTypeId,        case a.strTypeId when '1' then '产品' when '2' then '贸易' when '3' then '制造' else '' end as strTypeId1,        b.id,b.strApplyItem,b.strMatrlNo,b.strMatrlName,b.strUnit,b.strBrand,b.strSpec,b.bdSalePrice,b.bdPlanQty,b.bdApplyNumber,        b.bdPlanPrice,b.bdBalanceQty,b.strBalanceUserId,d.bdQty,b.strStus,        case b.strBalanceStus when 'Y' THEN '需采购' when 'N' then '无需采购' WHEN 'R' then '退回' else '' END as strBalanceStusZH,        m.bdMatrlQty,m.bdItemPurPrice,m.strMatrlNo as strMatrlNoZH,m.strMatrlName as strMatrlNameZH,m.strBrand as strBrandZH,m.strUnit as strUnitZH,m.strSpec as strSpecZH        from md_demand_m a        LEFT JOIN md_demand_d b ON a.strApplyNo = b.strApplyNo        LEFT JOIN mf_bom m ON b.strMatrlNo = m.strProdMatrlNo AND a.strTypeId="1"        LEFT JOIN mi_inventory d ON b.strMatrlNo = d.strMatrlNo*/		select		a.strApplyNo,a.strApplyName,a.strOrderNo,a.strVendorNo,a.strDept,a.strDemandUserId,a.strPlanYearMo,a.strRecipientId,a.strTypeId,		case a.strTypeId when '1' then '生产型原料' when '2' then '贸易型商品' when '3' then '维护型备件' else '' end as strTypeId1,		b.id,b.strApplyItem,b.strMatrlNo,b.strMatrlName,b.strUnit,b.strBrand,b.strSpec,b.bdSalePrice,b.bdPlanQty,b.bdApplyNumber,		b.bdPlanPrice,b.bdBalanceQty,b.strBalanceUserId,b.strStus,		(SELECT SUM(d.bdQty) FROM mi_inventory d where b.strMatrlNo = d.strMatrlNo) AS bdQtyZH,		case b.strBalanceStus when 'Y' THEN '需采购' when 'N' then '无需采购' WHEN 'R' then '退回' else '' END as strBalanceStusZH,		m.bdMatrlQty,m.bdItemPurPrice,m.strMatrlNo as strMatrlNoZH,m.strMatrlName as strMatrlNameZH,m.strBrand as strBrandZH,		m.strUnit as strUnitZH,m.strSpec as strSpecZH,m.strRemark,m.strStus		from md_demand_m a		LEFT JOIN md_demand_d b ON a.strApplyNo = b.strApplyNo		LEFT JOIN mf_bom m ON b.strMatrlNo = m.strProdMatrlNo AND a.strTypeId="1"		<where>			<if test="currentCompany != null and currentCompany != ''">				and a.companyId = #{currentCompany}			</if>			<if test="strRecipientId != null and strRecipientId != ''">				and a.strRecipientId = #{strRecipientId}			</if>			<if test="strApplyNo != null and strApplyNo != ''">				and a.strApplyNo like '%${strApplyNo}%'			</if>			<if test="strOrderNo != null and strOrderNo != ''">				and a.strOrderNo like '%${strOrderNo}%'			</if>			<if test="strTypeId != null and strTypeId != ''">				and a.strTypeId like '%${strTypeId}%'			</if>			<if test="strVendorNo != null and strVendorNo != ''">				and a.strVendorNo like '%${strVendorNo}%'			</if>			<if test="strApplyName != null and strApplyName != ''">				and strApplyName like '%${strApplyName}%'			</if>			<if test="strBalanceStus != null and strBalanceStus != ''">				and strBalanceStus like '%${strBalanceStus}%'			</if>			<if test="strStus != null and strStus != ''">				and m.strStus like '%${strStus}%'			</if>		</where>		order by a.createDateTime desc	</select>	<!-- 平衡分配： 查询所有记录 过滤公司别 -->	<select id="findBalanceAll02" parameterType="map" resultType="map">/*Y：需采购；N：无需采购；R：退回*/        select        a.strApplyNo,a.strApplyName,a.strOrderNo,a.strVendorNo,a.strDept,a.strDemandUserId,a.strPlanYearMo,a.strRecipientId,a.strTypeId,        case a.strTypeId when '1' then '生产型原料' when '2' then '贸易型商品' when '3' then '维护型备件' else '' end as strTypeId1,a.strDemandDate,        b.id,b.strApplyItem,b.strMatrlNo,b.strMatrlName,b.strUnit,b.strBrand,b.strSpec,b.bdSalePrice,b.bdPlanQty,b.bdApplyNumber,        b.bdPlanPrice,b.bdBalanceQty,b.strStus,(SELECT u.strName from du_user u WHERE u.id = b.strBalanceUserId) as strBalanceUserIdZH,b.strBalanceStus,        (SELECT SUM(d.bdQty) FROM mi_inventory d where b.strMatrlNo = d.strMatrlNo) AS bdQtyZH,        case b.strBalanceStus when 'Y' THEN '需采购' when 'N' then '无需采购' WHEN 'R' then '退回' else '' END as strBalanceStusZH,		(SELECT u.strName from du_user u WHERE u.id = a.strDemandUserId) AS strDemandUserIdZH        from md_demand_m a        LEFT JOIN md_demand_d b ON a.strApplyNo = b.strApplyNo		<where>			<if test="currentCompany != null and currentCompany != ''">				and a.companyId = #{currentCompany}			</if>			<if test="strRecipientId != null and strRecipientId != ''">				and a.strRecipientId = #{strRecipientId}			</if>			<if test="strApplyNo != null and strApplyNo != ''">				and a.strApplyNo like '%${strApplyNo}%'			</if>			<if test="strOrderNo != null and strOrderNo != ''">				and a.strOrderNo like '%${strOrderNo}%'			</if>			<if test="strVendorNo != null and strVendorNo != ''">				and a.strVendorNo like '%${strVendorNo}%'			</if>			<if test="strApplyName != null and strApplyName != ''">				and strApplyName like '%${strApplyName}%'			</if>			<if test="strBalanceStus != null and strBalanceStus != ''">				and b.strBalanceStus like '%${strBalanceStus}%'			</if>			<if test="strTypeId != null and strTypeId != ''">				and strTypeId like '%${strTypeId}%'			</if>			<if test="strStus != null and strStus != ''">				and b.strStus like '%${strStus}%'			</if>		</where>		order by a.createDateTime desc	</select>	<!-- 计划汇总： 查询所有记录 过滤公司别 -->	<select id="findSummaryAll" parameterType="map" resultType="map">/*Y：需采购；N：无需采购；R：退回*/		select		a.strApplyNo,a.strApplyName,a.strOrderNo,a.strVendorNo,a.strDept,a.strDemandUserId,a.strPlanYearMo,a.strRecipientId,a.strTypeId,		case a.strTypeId when '1' then '生产型原料' when '2' then '贸易型商品' when '3' then '维护型备件' else '' end as strTypeId1,a.strDemandDate,		b.id,b.strApplyItem,b.strMatrlNo,b.strMatrlName,b.strUnit,b.strBrand,b.strSpec,b.bdSalePrice,b.bdPlanQty,b.bdApplyNumber,		b.bdPlanPrice,b.bdBalanceQty,b.strBalanceUserId,b.strSumStus,		(SELECT u.strName from du_user u WHERE u.id = a.strDemandUserId) AS strDemandUserIdZH		from md_demand_m a		LEFT JOIN md_demand_d b ON a.strApplyNo = b.strApplyNo		<where>			<if test="currentCompany != null and currentCompany != ''">				and a.companyId = #{currentCompany}			</if>			<if test="strBalanceUserId != null and strBalanceUserId != ''">                and b.strBalanceUserId = #{strBalanceUserId}            </if>			<if test="strApplyNo != null and strApplyNo != ''">				and a.strApplyNo like '%${strApplyNo}%'			</if>			<if test="strOrderNo != null and strOrderNo != ''">				and a.strOrderNo like '%${strOrderNo}%'			</if>			<if test="strTypeId != null and strTypeId != ''">				and a.strTypeId like '%${strTypeId}%'			</if>			<if test="strVendorNo != null and strVendorNo != ''">				and a.strVendorNo like '%${strVendorNo}%'			</if>			<if test="strApplyName != null and strApplyName != ''">				and strApplyName like '%${strApplyName}%'			</if>			<if test="strBalanceStus != null and strBalanceStus != ''">				and b.strBalanceStus = #{strBalanceStus}			</if>			<if test="strSumStus != null and strSumStus !=''">				and b.strSumStus = #{strSumStus}			</if>		</where>		order by a.createDateTime desc	</select>	<!-- 查询所有记录 过滤公司别 -->	<select id="getCount" resultType="int" parameterType="map">		select count(id) from md_demand_m		<where>			<if test="currentCompany != null and currentCompany != ''">				and companyId = #{currentCompany}			</if>			<if test="strApplyNo != null and strApplyNo != ''">				and strApplyNo like '%${strApplyNo}%'			</if>			<if test="strOrderNo != null and strOrderNo != ''">				and strOrderNo like '%${strOrderNo}%'			</if>			<if test="strTypeId != null and strTypeId != ''">				and strTypeId like '%${strTypeId}%'			</if>			<if test="strVendorNo != null and strVendorNo != ''">				and strVendorNo like '%${strVendorNo}%'			</if>			<if test="strApplyName != null and strApplyName != ''">				and strApplyName  like '%${strApplyName}%'			</if>			<if test="strStus != null and strStus != ''">				and strStus like '%${strStus}%'			</if>		</where>	</select>		<!-- 根据ID查询记录 -->	<select id="findOneById" parameterType="String" resultType="map">		select 			*,case strStus when 'N' then '新增' when 'S' then '生效' else '' end as strStatuZH,strDemandUserId,			(SELECT u.strName from du_user u WHERE u.id = m.strRecipientId) AS strRecipientIdZH,			(SELECT u.strName from du_user u WHERE u.id = m.strDemandUserId) AS strDemandUserIdZH		from md_demand_m m		where id = #{id}	</select>	<!--根据需求申报单号查询-->	<select id="findOneByAppNo" parameterType="String" resultType="map">		select			*		from md_demand_m		where strApplyNo = #{strApplyNo}	</select>	<!-- 添加记录 -->	<insert id="create" parameterType="MdDemandMEntity">		insert into md_demand_m		(id, strApplyNo, strOrderNo, strTypeId, strPlanYearMo, strVendorNo, strApplyName, strDept, strDemandUserId, strDemandDate, strStus, strBalanceStus, strSumStus, strRemark, strEmpNo, strDateTime, strRecipientId, companyId, intIsActive, intIsDelete, createUserId, createDateTime)		values(#{id}, #{strApplyNo}, #{strOrderNo}, #{strTypeId}, #{strPlanYearMo}, #{strVendorNo}, #{strApplyName}, #{strDept}, #{strDemandUserId}, #{strDemandDate}, #{strStus}, #{strBalanceStus}, #{strSumStus}, #{strRemark}, #{strEmpNo}, #{strDateTime}, #{strRecipientId}, #{company.id}, #{intIsActive}, #{intIsDelete}, #{createUser.id}, #{createDateTime})	</insert>		<!-- 修改记录 -->	<update id="update" parameterType="MdDemandMEntity">		update md_demand_m		<set>			<if test="strApplyNo != null and strApplyNo != ''">				strApplyNo = #{strApplyNo},			</if>			<if test="strOrderNo != null and strOrderNo != ''">				strOrderNo = #{strOrderNo},			</if>			<if test="strTypeId != null and strTypeId != ''">				strTypeId = #{strTypeId},			</if>			<if test="strPlanYearMo != null and strPlanYearMo != ''">				strPlanYearMo = #{strPlanYearMo},			</if>			<if test="strVendorNo != null and strVendorNo != ''">				strVendorNo = #{strVendorNo},			</if>			<if test="strApplyName != null and strApplyName != ''">				strApplyName = #{strApplyName},			</if>			<if test="strDept != null and strDept != ''">				strDept = #{strDept},			</if>			<if test="strDemandUserId != null and strDemandUserId != ''">				strDemandUserId = #{strDemandUserId},			</if>			<if test="strDemandDate != null and strDemandDate != ''">				strDemandDate = #{strDemandDate},			</if>			<if test="strStus != null and strStus != ''">				strStus = #{strStus},			</if>			<if test="strBalanceStus != null and strBalanceStus != ''">				strBalanceStus = #{strBalanceStus},			</if>			<if test="strSumStus != null and strSumStus != ''">				strSumStus = #{strSumStus},			</if>			<if test="strRemark != null and strRemark != ''">				strRemark = #{strRemark},			</if>			<if test="strEmpNo != null and strEmpNo != ''">				strEmpNo = #{strEmpNo},			</if>			<if test="strDateTime != null and strDateTime != ''">				strDateTime = #{strDateTime},			</if>			<if test="strRecipientId != null and strRecipientId != ''">				strRecipientId = #{strRecipientId},			</if>			<if test="updateUser != null">				updateUserId = #{updateUser.id},			</if>			<if test="updateDateTime != null and updateDateTime != ''">				updateDateTime = #{updateDateTime},			</if>			<if test="intIsActive != null and intIsActive != ''">				intIsActive = #{intIsActive},			</if>			<if test="intIsDelete != null and intIsDelete != ''">				intIsDelete = #{intIsDelete}			</if>		</set>		<where>			id = #{id}		</where>	</update>		<!-- 删除记录 -->	<delete id="delete" parameterType="String">		delete from md_demand_m where id = #{id}	</delete>    <!--在code的前提下获得当前最大销售点单编号-->    <select id="findMaxCode" parameterType="String" resultType="String">		select MAX(strApplyNo) from md_demand_m a where strApplyNo like #{strApplyNo}	</select>	<!--在code的前提下获得当前最大采购计划单号-->	<select id="findPlanNoMaxCode" parameterType="String" resultType="String">		select MAX(strPlanNo) from mp_plan a where strPlanNo like #{strPlanNo}	</select></mapper>